
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Get started &#8212; forestatrisk 0.2 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Reference" href="../reference.html" />
    <link rel="prev" title="forestatrisk Python package" href="../index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Get-started">
<h1>Get started<a class="headerlink" href="#Get-started" title="Permalink to this headline">Â¶</a></h1>
<p>This notebook will show you how to use the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> Python module. The module can be used to estimate the spatial probability of deforestation in the tropics depending on various spatial environmental variables. We use Madagascar as a case study.</p>
<p>We first import the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> module and the other necessary modules to run the script.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Import modules</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">patsy</span> <span class="kn">import</span> <span class="n">dmatrices</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">forestatrisk</span> <span class="k">as</span> <span class="nn">far</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# ==================================================================== #
# ForestAtRisk: modelling and forecasting deforestation in the tropics #
# https://ecology.ghislainv.fr/forestatrisk                            #
# ==================================================================== #
</pre></div></div>
</div>
<p>We also create a directory to hold the outputs with the help of the function <code class="docutils literal notranslate"><span class="pre">.make_dir()</span></code> from the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> module.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Make output directory</span>
<span class="n">far</span><span class="o">.</span><span class="n">make_dir</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Downloading-and-preparing-the-data">
<h2>Downloading and preparing the data<a class="headerlink" href="#Downloading-and-preparing-the-data" title="Permalink to this headline">Â¶</a></h2>
<p>To model the spatial probability of deforestation, we need a map of the past deforestation and maps of potential explicative environmental variables. Environmental variables can be derived from topography (altitude, slope, and aspect), accessibility (distance to roads, towns, and forest edge), deforestation history (distance to previous deforestation) or landscape policy (location inside a protected area) for example. In our example, we use the following variables :</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 21%" />
<col style="width: 31%" />
<col style="width: 4%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Product</p></th>
<th class="head"><p>Source</p></th>
<th class="head"><p>Variable derived</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Resolution (m)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Deforestation maps (1990-2000-2010)</p></td>
<td><p>BioSceneMada (1)</p></td>
<td><p>forest/non-forest</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>30</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td></td>
<td><p>distance to forest edge</p></td>
<td><p>m</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td></td>
<td><p>distance to previous deforestation</p></td>
<td><p>m</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-odd"><td><p>Digital Elevation Model</p></td>
<td><p>SRTM v4.1 CSI-CGIAR (2)</p></td>
<td><p>altitude</p></td>
<td><p>m</p></td>
<td><p>90</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td></td>
<td><p>slope</p></td>
<td><p>Â°</p></td>
<td><p>90</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td></td>
<td><p>aspect</p></td>
<td><p>Â°</p></td>
<td><p>90</p></td>
</tr>
<tr class="row-even"><td><p>Highways</p></td>
<td><p>OSM - Geofabrik (3)</p></td>
<td><p>distance to roads</p></td>
<td><p>m</p></td>
<td><p>150</p></td>
</tr>
<tr class="row-odd"><td><p>Places</p></td>
<td></td>
<td><p>distance to towns</p></td>
<td><p>m</p></td>
<td><p>150</p></td>
</tr>
<tr class="row-even"><td><p>Waterways</p></td>
<td></td>
<td><p>distance to river</p></td>
<td><p>m</p></td>
<td><p>150</p></td>
</tr>
<tr class="row-odd"><td><p>Protected areas</p></td>
<td><p>Rebioma (4)</p></td>
<td><p>presence of protected area</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>30</p></td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li><p><a class="reference external" href="http://bioscenemada.cirad.fr">http://bioscenemada.cirad.fr</a>, deforestation maps derived from Harper et al.Â 2007 and Hansen et al.Â 2013</p></li>
<li><p><a class="reference external" href="http://srtm.csi.cgiar.org">http://srtm.csi.cgiar.org</a>, SRTM 90m Digital Elevation Database v4.1</p></li>
<li><p><a class="reference external" href="http://www.geofabrik.de">http://www.geofabrik.de</a>, data extracts from the OpenStreetMap project for Madagascar,</p></li>
<li><p><a class="reference external" href="http://rebioma.net">http://rebioma.net</a>, SAPM (âSystÃ¨me des Aires ProtÃ©gÃ©es Ã  Madagascarâ), 20/12/2010 version</p></li>
</ol>
<p>To obtain the data, we can either (i) execute a bash script which downloads the raw data from the sources and computes the variables, or (ii) directly download the derived variables from a repository on Zenodo (<a class="reference external" href="http://doi.org/10.5281/zenodo.259582">http://doi.org/10.5281/zenodo.259582</a>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># =====================================</span>
<span class="c1"># First option: execute the bash script</span>
<span class="c1"># =====================================</span>

<span class="c1"># os.system(&quot;wget https://github.com/ghislainv/forestatrisk/blob/master/notebook/scripts/dataMada.sh&quot;)</span>
<span class="c1"># os.system(&quot;sh data_Mada.sh&quot;)</span>

<span class="c1"># =====================================</span>
<span class="c1"># Second option: download the data</span>
<span class="c1"># =====================================</span>

<span class="c1"># Make data directory</span>
<span class="n">far</span><span class="o">.</span><span class="n">make_dir</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>

<span class="c1"># List of files to download</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fordefor2010.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;dist_edge.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;dist_defor.tif&quot;</span><span class="p">,</span>
         <span class="s2">&quot;altitude.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;slope.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;aspect.tif&quot;</span><span class="p">,</span>
         <span class="s2">&quot;dist_road.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;dist_town.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;dist_river.tif&quot;</span><span class="p">,</span>
         <span class="s2">&quot;sapm.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;roads.kml&quot;</span><span class="p">,</span> <span class="s2">&quot;towns.kml&quot;</span><span class="p">,</span> <span class="s2">&quot;rivers.kml&quot;</span><span class="p">,</span> <span class="s2">&quot;sapm.kml&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;wget -P data https://zenodo.org/record/259582/files/&quot;</span> <span class="o">+</span> <span class="n">i</span>
    <span class="c1">#os.system(cmd)</span>
</pre></div>
</div>
</div>
<p>In our example, <code class="docutils literal notranslate"><span class="pre">fordefor2010.tif</span></code> is a forest raster at 30m for the year 2010 considering the deforestation on the period 2000-2010 in Madagascar. We can plot this raster and zoom on a region with function <code class="docutils literal notranslate"><span class="pre">.plot.forest()</span></code> in the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> package to see the deforestation data. The remaining forest appears in green and the deforested areas appear in red.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># ========================================================</span>
<span class="c1"># Plot forest</span>
<span class="c1"># ========================================================</span>
<span class="n">fig_fcc123</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">fcc123</span><span class="p">(</span><span class="n">input_fcc_raster</span><span class="o">=</span><span class="s2">&quot;data/forest/fcc123.tif&quot;</span><span class="p">,</span>
                <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/fcc123.png&quot;</span><span class="p">,</span>
                <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
                <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Build overview
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_9_1.png" src="../_images/notebooks_get_started_9_1.png" />
</div>
</div>
<p>We can also plot the environmental raster files using function <code class="docutils literal notranslate"><span class="pre">.plot.var()</span></code> in the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> package.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># ========================================================</span>
<span class="c1"># Plot environmental variables</span>
<span class="c1"># ========================================================</span>
<span class="n">var_fig</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">var_dir</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
                       <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/var.pdf&quot;</span><span class="p">,</span>
                       <span class="n">gridsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                       <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
                       <span class="n">dpi</span><span class="o">=</span><span class="mi">125</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_11_0.png" src="../_images/notebooks_get_started_11_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_11_1.png" src="../_images/notebooks_get_started_11_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_11_2.png" src="../_images/notebooks_get_started_11_2.png" />
</div>
</div>
</div>
<div class="section" id="Sampling-the-observations">
<h2>Sampling the observations<a class="headerlink" href="#Sampling-the-observations" title="Permalink to this headline">Â¶</a></h2>
<p>We use the function <code class="docutils literal notranslate"><span class="pre">.sample()</span></code> from the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> module to sample 10,000 points (pixel centers) in the deforested areas and in the remaining forest (20,000 points in total). The <code class="docutils literal notranslate"><span class="pre">input_forest_raster</span></code> argument defines the path to the forest raster including the deforested pixels (with value=0) and the remaining forest pixels (value=1) after a given period of time. The random seed can be set with argument <code class="docutils literal notranslate"><span class="pre">Seed</span></code> to reproduce the data of the random sampling.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.sample()</span></code> function also extracts information from environmental variables for each sampled point. Sampling is done by block to allow the computation on large study areas (e.g.Â country or continental scale) with a fine spatial resolution (e.g.Â 30m). The <code class="docutils literal notranslate"><span class="pre">var_dir</span></code> argument indicates the directory including all the environmental raster files (they must be GeoTIFF files with extension <code class="docutils literal notranslate"><span class="pre">.tif</span></code>) that we want to test.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.sample()</span></code> function identifies the spatial cell for each sample point (sample point are grouped within a spatial cell). Spatial cells and grouped observations are used to estimate the spatial autocorrelation of the deforestation process. The <code class="docutils literal notranslate"><span class="pre">csize</span></code> argument define the width (in km) of the square spatial cells. Each spatial cell will be attributed a parameter. To avoid estimating too many parameters, width of the square spatial cells must be sufficiently large. Both points sampling and
extraction of environmental data are done by block to avoid memory problems for big datasets.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">help</span><span class="p">(</span><span class="n">far</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on function sample in module forestatrisk.build_data.sample:

sample(nsamp=10000, adapt=True, Seed=1234, csize=10, var_dir=&#39;data&#39;, input_forest_raster=&#39;forest.tif&#39;, output_file=&#39;output/sample.txt&#39;, blk_rows=0)
    Sample points and extract raster values.

    This function (i) randomly draws spatial points in deforested and
    forested areas and (ii) extract environmental variable values for
    each spatial point.

    :param nsamp: Number of random spatial points.

    :param adapt: Adapt ``nsamp`` to forest area: 1000 for 1 Mha of
        forest, with min=10000 and max=50000.

    :param seed: Seed for random number generator.

    :param csize: Spatial cell size in km.

    :param var_dir: Directory with raster data.

    :param input_forest_raster: Name of the forest raster file
       (1=forest, 0=deforested) in the var_dir directory.

    :param output_file: Path to file to save sample points.

    :param blk_rows: If &gt; 0, number of lines per block.

    :return: A Pandas DataFrame, each row being one observation.

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># ========================================================</span>
<span class="c1"># Sample</span>
<span class="c1"># ========================================================</span>

<span class="c1"># Sample points</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nsamp</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">adapt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span> <span class="n">csize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                     <span class="n">var_dir</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
                     <span class="n">input_forest_raster</span><span class="o">=</span><span class="s2">&quot;fcc23.tif&quot;</span><span class="p">,</span>
                     <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/sample.txt&quot;</span><span class="p">,</span>
                     <span class="n">blk_rows</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Sample 2x 10000 pixels (deforested vs. forest)
Divide region in 110 blocks
Compute number of deforested and forest pixels per block
100%
Draw blocks at random
Draw pixels at random in blocks
100%
Compute center of pixel coordinates
Compute number of 10 x 10 km spatial cells
... 64 cells (8 x 8)
Identify cell number from XY coordinates
Make virtual raster with variables as raster bands
Extract raster values for selected pixels
100%
Export results to file output/sample.txt
</pre></div></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">`pandas</span></code> &lt;<a class="reference external" href="http://pandas.pydata.org/">http://pandas.pydata.org/</a>&gt;`__ <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> is returned by the function (each row being an observation) and the sampled observations are also written to a text file defined by the argument <code class="docutils literal notranslate"><span class="pre">output_file</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># To import data as pandas DataFrame if necessary</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s2">&quot;output/sample.txt&quot;</span><span class="p">,</span>
                         <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

<span class="c1"># Print the first five rows</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
   altitude  dist_defor  dist_edge  dist_river  dist_road  dist_town  fcc23  \
0     250.0      1071.0       30.0       600.0      808.0     1710.0    0.0
1     381.0      3204.0       30.0       750.0        0.0      750.0    0.0
2     483.0      3051.0       30.0      1383.0      335.0      750.0    0.0
3      87.0       242.0       30.0         0.0      150.0     2148.0    0.0
4     107.0       836.0       30.0      1050.0        0.0     2554.0    0.0

    pa  slope          X          Y  cell
0  0.0   12.0  6167205.0 -2363385.0   2.0
1  0.0   12.0  6170595.0 -2362725.0   2.0
2  0.0    9.0  6170055.0 -2363865.0   2.0
3  0.0   17.0  6167625.0 -2362455.0   2.0
4  0.0   23.0  6166635.0 -2362635.0   2.0
</pre></div></div>
</div>
<p>Sampled observations can be plotted using function <code class="docutils literal notranslate"><span class="pre">.plot.obs()</span></code> from the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> module. Dark red dots indicate deforestation observations and dark green dots indicate forest observations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">-</span><span class="p">(</span><span class="mi">6176000</span><span class="o">-</span><span class="mi">6179500</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="mi">2400500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-2397000
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot sample points</span>
<span class="n">fig_obs</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">obs</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
             <span class="n">name_forest_var</span><span class="o">=</span><span class="s2">&quot;fcc23&quot;</span><span class="p">,</span>
             <span class="n">input_fcc_raster</span><span class="o">=</span><span class="s2">&quot;data/fcc23.tif&quot;</span><span class="p">,</span>
             <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/obs.png&quot;</span><span class="p">,</span>
             <span class="n">zoom</span><span class="o">=</span><span class="p">(</span><span class="mi">6166000</span><span class="p">,</span> <span class="mi">6179500</span><span class="p">,</span> <span class="o">-</span><span class="mi">2410500</span><span class="p">,</span> <span class="o">-</span><span class="mi">2397000</span><span class="p">),</span>  <span class="c1"># xmin, xmax, ymin, ymax</span>
             <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_21_0.png" src="../_images/notebooks_get_started_21_0.png" />
</div>
</div>
</div>
<div class="section" id="Descriptive-statistics">
<h2>Descriptive statistics<a class="headerlink" href="#Descriptive-statistics" title="Permalink to this headline">Â¶</a></h2>
<p>Before modelling the deforestation, it is important to look at the relationship between environmental variables and deforestation. Using formulas from the <code class="docutils literal notranslate"><span class="pre">`patsy</span></code> &lt;<a class="reference external" href="https://github.com/pydata/patsy">https://github.com/pydata/patsy</a>&gt;`__ Python module, we can specify the relationships that we want to look at. In the example below, we plot the relationships between some continuous environmental variables and the probability of deforestation using function <code class="docutils literal notranslate"><span class="pre">.plot.correlation()</span></code> from the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> package. Note that -1 must
be set at the end of the formula.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># ========================================================</span>
<span class="c1"># Descriptive statistics</span>
<span class="c1"># ========================================================</span>

<span class="c1"># To import data as pandas DataFrame if necessary</span>
<span class="c1"># dataset = pd.read_table(&quot;output/sample.txt&quot;,</span>
<span class="c1">#                         delimiter=&quot;,&quot;)</span>

<span class="c1"># Model formulas</span>
<span class="n">formula_1</span> <span class="o">=</span> <span class="s2">&quot;fcc23 ~ dist_road + dist_town + dist_defor + </span><span class="se">\</span>
<span class="s2">dist_river + dist_edge + altitude + slope - 1&quot;</span>
<span class="c1"># Standardized variables (mean=0, std=1)</span>
<span class="n">formula_2</span> <span class="o">=</span> <span class="s2">&quot;fcc23 ~ scale(dist_road) + scale(dist_town) + </span><span class="se">\</span>
<span class="s2">scale(dist_defor) + scale(dist_river) + scale(dist_edge) + </span><span class="se">\</span>
<span class="s2">scale(altitude) + scale(slope) - 1&quot;</span>
<span class="n">formulas</span> <span class="o">=</span> <span class="p">(</span><span class="n">formula_1</span><span class="p">,</span> <span class="n">formula_2</span><span class="p">)</span>

<span class="c1"># List to store figures</span>
<span class="n">corr_fig</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Remove NA from data-set (otherwise scale() doesn&#39;t work)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Loop on formulas</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formulas</span><span class="p">)):</span>
    <span class="c1"># Output file</span>
    <span class="n">of</span> <span class="o">=</span> <span class="s2">&quot;output/correlation_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.pdf&quot;</span>
    <span class="c1"># Data</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">dmatrices</span><span class="p">(</span><span class="n">formulas</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
                        <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;dataframe&quot;</span><span class="p">)</span>

    <span class="c1"># Plots</span>
    <span class="n">corr_fig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                         <span class="n">plots_per_page</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                         <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
                                         <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                         <span class="n">output_file</span><span class="o">=</span><span class="n">of</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_23_0.png" src="../_images/notebooks_get_started_23_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_23_1.png" src="../_images/notebooks_get_started_23_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_23_2.png" src="../_images/notebooks_get_started_23_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_23_3.png" src="../_images/notebooks_get_started_23_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_23_4.png" src="../_images/notebooks_get_started_23_4.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_23_5.png" src="../_images/notebooks_get_started_23_5.png" />
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">.correlation()</span></code> returns a serie of graphics that can be analyzed to choose the right relationship for each continuous variable (linear or polynomial for example).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Correlation plots</span>
<span class="n">corr_fig</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_25_0.png" src="../_images/notebooks_get_started_25_0.png" />
</div>
</div>
<p>In this example, we can see that a linear model should be sufficient to represent the relationship between the probability of deforestation and the standardized distance to the nearest road or town. On the contrary, it could be interesting to fit a polynomial model for the the standardized distance to previous deforestation (<code class="docutils literal notranslate"><span class="pre">dist_defor</span></code> variable) for which the relationship seems non-linear. Several models can be fitted and compared to see if a second-order or third-order polynomial
relationship is justified.</p>
</div>
<div class="section" id="Spatial-deforestation-model">
<h2>Spatial deforestation model<a class="headerlink" href="#Spatial-deforestation-model" title="Permalink to this headline">Â¶</a></h2>
<p>We propose to use the <strong>Binomial iCAR</strong> model (<a class="reference external" href="http://doi.org/10.5281/zenodo.48470">Vieilledent et al.Â 2014</a>) to estimate the deforestation probability of a pixel given a set of environmental variables. The Binomial iCAR model is a linear Binomial logistic regression model including an intrinsic Conditional Autoregressive (iCAR) process to account for the spatial autocorrelation of the observations. Parameter inference is done in a hierarchical Bayesian framework. The
<code class="docutils literal notranslate"><span class="pre">.model_binomial_iCAR()</span></code> function from the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> module includes a Metropolis-within-Gibbs algorithm written in pure C code to reduce computation time.</p>
<p><img alt="Bayes" src="../_images/Bayes.jpg" /> <strong>Figure caption:</strong> Parameter inference is done in a hierarchical Bayesian framework, which relies on the <a class="reference external" href="https://en.wikipedia.org/wiki/Bayes'_theorem">Bayesâ theorem</a> named after <a class="reference external" href="https://en.wikipedia.org/wiki/Thomas_Bayes">Reverend Thomas Bayes</a>. Each parameter has a prior and an approximated posterior probability distribution from which we can compute the mean, standard deviation, credible intervals at 95%, etc.</p>
<p>For the deforestation process it is <strong>very important to take into account the spatial autocorrelation of the process</strong> with spatial random effects. Indeed, the selected fixed environmental variables are not able to fully explain the spatial variability of the deforestation process, especially when working at large geographical scales, such as the national or continental scale. Spatial random effects allow estimating a higher/lower probability of deforestation in a particular region (associated
to unmeasurable or unknow factors) that is different from the mean probability of deforestation derived from the environmental factors included in the model. The Binomial iCAR model can be discribed as follow:</p>
<p><strong>Ecological process</strong></p>
<p><span class="math">\begin{equation}
y_i \sim \mathcal{B}inomial(\theta_i,t_i) \\
\text{logit}(\theta_i) = X_i \beta + \rho_{j(i)}
\end{equation}</span></p>
<p><span class="math notranslate nohighlight">\(y_i\)</span>: random variable for the deforestation process (0 if no deforestation, 1 if deforestation)</p>
<p><span class="math notranslate nohighlight">\(\theta_i\)</span>: probability of deforestation</p>
<p><span class="math notranslate nohighlight">\(t_i\)</span>: number of trials (always 1 in our example)</p>
<p><span class="math notranslate nohighlight">\(X_i\)</span>: vector of values for environmental explicative variables</p>
<p><span class="math notranslate nohighlight">\(\beta\)</span>: vector of fixed effect parameters</p>
<p><span class="math notranslate nohighlight">\(\rho_j\)</span>: spatial random effect</p>
<p><span class="math notranslate nohighlight">\(j(i)\)</span>: index of the spatial entity for observation <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p><strong>Spatial autocorrelation</strong></p>
<p>The spatial autocorrelation is modelled with an intrinsic conditional autoregressive (iCAR) process:</p>
<p><span class="math">\begin{equation}
\rho_j \sim \mathcal{N}ormal(\mu_j,V_{\rho} / n_j)
\end{equation}</span></p>
<p><span class="math notranslate nohighlight">\(\mu_j\)</span>: mean of <span class="math notranslate nohighlight">\(\rho_{j'}\)</span> in the neighborhood of <span class="math notranslate nohighlight">\(j\)</span>.</p>
<p><span class="math notranslate nohighlight">\(V_{\rho}\)</span>: variance of the spatial random effects.</p>
<p><span class="math notranslate nohighlight">\(n_j\)</span>: number of neighbors for spatial entity <span class="math notranslate nohighlight">\(j\)</span>.</p>
<p><img alt="iCAR process" src="../_images/iCAR.png" /> <strong>Figure caption:</strong> Representation of the neighborhood for the intrinsic conditional autoregressive (iCAR) process. Target spatial cell <span class="math notranslate nohighlight">\(j\)</span> has 8 neighbors in this case. Several observations (black points, equivalent to pixel centers in our case) can be located in each spatial cell. Deforestation probability in one spatial cell <span class="math notranslate nohighlight">\(j\)</span> depends on deforestation probability in neighboring cells.</p>
<p>Before running the model, we add a column indicating the number of trials for each observation (1 in our case as we are considering a Bernoulli process). We then remove any observation with non-available data (NA) from the data-set. We also compute the number of neighbors (<code class="docutils literal notranslate"><span class="pre">nneigh</span></code>) and the neighbor identifiers (<code class="docutils literal notranslate"><span class="pre">adj</span></code>) for each spatial cell using function <code class="docutils literal notranslate"><span class="pre">.cellneigh</span></code> from the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> module.</p>
<p>A model formula must also be defined to specify the explicative variables we want to include in the model. The formula allows specifying some variable transformations (such as standardization in our case). See the <code class="docutils literal notranslate"><span class="pre">`patsy</span></code> &lt;<a class="reference external" href="https://patsy.readthedocs.io/en/latest/">https://patsy.readthedocs.io/en/latest/</a>&gt;`__ module for more information. In our model, we included the following variables: location inside a protected area, altitude, distance to past deforestation (with a degree two polynomial), distance to forest edge, distance to
nearest road and distance to nearest town. The formula must end with the name of the variable indicating the spatial cell for each observation (<code class="docutils literal notranslate"><span class="pre">cell</span></code> in our case).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># ========================================================</span>
<span class="c1"># hierarchical Bayesian model</span>
<span class="c1"># ========================================================</span>

<span class="c1"># Set number of trials to one</span>
<span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;trial&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Remove observations with NA</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Spatial cells for spatial-autocorrelation</span>
<span class="n">nneigh</span><span class="p">,</span> <span class="n">adj</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">cellneigh</span><span class="p">(</span><span class="n">raster</span><span class="o">=</span><span class="s2">&quot;data/fcc23.tif&quot;</span><span class="p">,</span> <span class="n">csize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Formula</span>
<span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;I(1-fcc23) + trial ~ C(pa) + scale(altitude) +  scale(slope) + </span><span class="se">\</span>
<span class="s2">scale(dist_defor) + np.power(scale(dist_defor),2) + </span><span class="se">\</span>
<span class="s2">scale(dist_edge) + </span><span class="se">\</span>
<span class="s2">scale(dist_road) + scale(dist_town) + cell&quot;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Compute number of 10 x 10 km spatial cells
... 64 cells (8 x 8)
Identify adjacent cells and compute number of neighbors
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Model</span>
<span class="n">mod_binomial_iCAR</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">model_binomial_iCAR</span><span class="p">(</span>
    <span class="c1"># Observations</span>
    <span class="n">suitability_formula</span><span class="o">=</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
    <span class="c1"># Spatial structure</span>
    <span class="n">n_neighbors</span><span class="o">=</span><span class="n">nneigh</span><span class="p">,</span> <span class="n">neighbors</span><span class="o">=</span><span class="n">adj</span><span class="p">,</span>
    <span class="c1"># Chains</span>
    <span class="n">burnin</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">mcmc</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="c1"># Starting values</span>
    <span class="n">beta_start</span><span class="o">=-</span><span class="mi">99</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Using estimates from classic logistic regression as starting values for betas
</pre></div></div>
</div>
</div>
<div class="section" id="Results-of-the-model">
<h2>Results of the model<a class="headerlink" href="#Results-of-the-model" title="Permalink to this headline">Â¶</a></h2>
<p>Once the model has been fitted, we can print a summary of the model showing the parameter estimates. The 95% credible intervals obtained from the posterior distribution of each parameter, except distance to nearest town (<code class="docutils literal notranslate"><span class="pre">dist_town</span></code>), do not include zero, indicating that parameters are significantly different from zero. The variance of the spatial random effects (<code class="docutils literal notranslate"><span class="pre">Vrho</span></code>) is given together with the deviance value, which can be used to compare different statistical models (lower deviance is
better). Looking at the parameter estimates, we can see that the deforestation probability is much lower inside protected areas and that deforestation probability decreases with altitude, slope, distance to past deforestation, forest edge, roads and towns. Parameter values are then coherent regarding the deforestation process and easy to interpret.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Summary</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mod_binomial_iCAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Binomial logistic regression with iCAR process
  Model: I(1 - fcc23) + trial ~ 1 + C(pa) + scale(altitude) + scale(slope) + scale(dist_defor) + np.power(scale(dist_defor), 2) + scale(dist_edge) + scale(dist_road) + scale(dist_town) + cell
  Posteriors:
                                     Mean        Std     CI_low    CI_high
                     Intercept     -0.968      0.132      -1.21     -0.724
                  C(pa)[T.1.0]     -0.536      0.123     -0.749     -0.275
               scale(altitude)      0.229     0.0445      0.139      0.307
                  scale(slope)      -0.28     0.0284     -0.332     -0.222
             scale(dist_defor)     -0.326     0.0297     -0.382     -0.273
np.power(scale(dist_defor), 2)     0.0724     0.0325    0.00963      0.138
              scale(dist_edge)      -3.92      0.228      -4.36      -3.43
              scale(dist_road)     -0.283      0.037     -0.355     -0.213
              scale(dist_town)        0.3     0.0442      0.219       0.38
                          Vrho       1.91      0.507       1.16       3.09
                      Deviance   1.88e+04         38   1.88e+04   1.89e+04

</pre></div></div>
</div>
<p>To check for the convergence of the Markov chain Monte Carlo (MCMC), we can plot the traces and the posterior distributions of the estimated parameters using method <code class="docutils literal notranslate"><span class="pre">.plot()</span></code> associated to the <code class="docutils literal notranslate"><span class="pre">hSDM_binomial_iCAR</span></code> class defined in the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> module. This method returns the figures showing the traces and posterior distributions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot</span>
<span class="n">traces_fig</span> <span class="o">=</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/mcmc.pdf&quot;</span><span class="p">,</span>
                                    <span class="n">plots_per_page</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
                                    <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Traces and posteriors will be plotted in output/mcmc.pdf
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_35_1.png" src="../_images/notebooks_get_started_35_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_35_2.png" src="../_images/notebooks_get_started_35_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_35_3.png" src="../_images/notebooks_get_started_35_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_35_4.png" src="../_images/notebooks_get_started_35_4.png" />
</div>
</div>
</div>
<div class="section" id="Predicting-the-spatial-probability-of-deforestation">
<h2>Predicting the spatial probability of deforestation<a class="headerlink" href="#Predicting-the-spatial-probability-of-deforestation" title="Permalink to this headline">Â¶</a></h2>
<p>We use the model to predict the spatial probability of deforestation at the national scale for Madagascar. Before, doing so, we smooth the spatial random effects which have been estimated at a coarse resolution (10km in our example). To do so, we use the function <code class="docutils literal notranslate"><span class="pre">.interpolate_rho()</span></code> from the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> module to resample the results at a finer resolution using a bilinear interpolation. The function writes a raster file to the disk with a resolution of the raster specified in the
argument <code class="docutils literal notranslate"><span class="pre">input_raster</span></code> of the function (1km in our case). The function <code class="docutils literal notranslate"><span class="pre">.interpolate_rho()</span></code> returns a figure of the spatial random effects that can be plotted.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># ========================================================</span>
<span class="c1"># Resampling spatial random effects</span>
<span class="c1"># ========================================================</span>

<span class="c1"># Spatial random effects</span>
<span class="n">rho</span> <span class="o">=</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">rho</span>

<span class="c1"># Resample</span>
<span class="n">far</span><span class="o">.</span><span class="n">interpolate_rho</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">input_raster</span><span class="o">=</span><span class="s2">&quot;data/fcc23.tif&quot;</span><span class="p">,</span>
                    <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/rho.tif&quot;</span><span class="p">,</span>
                    <span class="n">csize_orig</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">csize_new</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Write spatial random effect data to disk
Compute statistics
Build overview
Resampling spatial random effects to file output/rho.tif
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig_rho</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="s2">&quot;output/rho.tif&quot;</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/rho.png&quot;</span><span class="p">,</span>
                       <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Build overview
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_38_1.png" src="../_images/notebooks_get_started_38_1.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.predict()</span></code> function of the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> module can be used to predict the spatial probability of deforestation from a <strong>binomial_iCAR</strong> model (i.e.Â an object of class <code class="docutils literal notranslate"><span class="pre">model_binomial_iCAR</span></code>). The function writes a raster of predictions to the disk and returns a figure with the predictions that can be plotted. The prediction is done by block to avoid memory problems for big datasets. Functions will return NA for pixels with no forest or for pixels with missing environmental
variables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># ========================================================</span>
<span class="c1"># Predicting spatial probability of deforestation</span>
<span class="c1"># ========================================================</span>

<span class="c1"># Compute predictions</span>
<span class="n">far</span><span class="o">.</span><span class="n">predict_raster_binomial_iCAR</span><span class="p">(</span>
    <span class="n">mod_binomial_iCAR</span><span class="p">,</span> <span class="n">var_dir</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
    <span class="n">input_cell_raster</span><span class="o">=</span><span class="s2">&quot;output/rho.tif&quot;</span><span class="p">,</span>
    <span class="n">input_forest_raster</span><span class="o">=</span><span class="s2">&quot;data/forest/forest_t3.tif&quot;</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/prob.tif&quot;</span><span class="p">,</span>
    <span class="n">blk_rows</span><span class="o">=</span><span class="mi">10</span>  <span class="c1"># Reduced number of lines to avoid memory problems</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Make virtual raster with variables as raster bands
Divide region in 239 blocks
Create a raster file on disk for projections
Predict deforestation probability by block
100%
Compute statistics
</pre></div></div>
</div>
<p>We can then plot the spatial probability of deforestation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the spatial probability of deforestation.</span>
<span class="n">fig_pred</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fig_pred</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_42_0.png" src="../_images/notebooks_get_started_42_0.png" />
</div>
</div>
</div>
<div class="section" id="Predicting-the-future-forest-cover">
<h2>Predicting the future forest cover<a class="headerlink" href="#Predicting-the-future-forest-cover" title="Permalink to this headline">Â¶</a></h2>
<p>Given the spatial probability of deforestation and the number of hectares that should be deforested, we can predict the future forest cover using function <code class="docutils literal notranslate"><span class="pre">.deforest()</span></code> from the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> package. The number of hectares are converted into number of pixels to be deforested. Pixels with the highest probability of deforestation are deforested first. The function computes a probability threshold above which pixels are deforested.</p>
<p>In our example, we consider an annual deforestation of roughly 100,000 ha for Madagascar. Considering the period 2010-2050, this would correspond to 4 Mha of deforestation. This number can of course be more precise and refined considering various deforestation scenarios (demographic growth, economic development, etc.).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># ========================================================</span>
<span class="c1"># Predicting forest cover</span>
<span class="c1"># ========================================================</span>

<span class="n">forest_cover</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">deforest</span><span class="p">(</span><span class="n">input_raster</span><span class="o">=</span><span class="s2">&quot;output/pred_binomial_iCAR.tif&quot;</span><span class="p">,</span>
                            <span class="n">hectares</span><span class="o">=</span><span class="mi">4000000</span><span class="p">,</span>
                            <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/forest_cover_2050.tif&quot;</span><span class="p">,</span>
                            <span class="n">blk_rows</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Divide region in 398 blocks
Compute the total number of forest pixels
100%
Compute the histogram of values
100%
Identify threshold
Minimize error on deforested hectares
Create a raster file on disk for forest cover
Write raster of forest cover
100%
Compute statistics
Build overview
Make figure
</pre></div></div>
</div>
<p>Because deforestation probability is scaled on the interval [1, 65535] including 65535 values, there might be a difference between the deforested hectares set as input and the true deforested surfaces. The magnitude of the difference depends on the distribution of the deforestation probabilities. Usually, the distribution of the deforestation probabilities should be asymmetric with low frequencies for higher probabilities of deforestation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Distribution of the deforestation probabilities</span>
<span class="n">frequences</span> <span class="o">=</span> <span class="n">forest_cover</span><span class="p">[</span><span class="s2">&quot;statistics&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="n">forest_cover</span><span class="p">[</span><span class="s2">&quot;statistics&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">frequences</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Frequencies of deforestation probabilities&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">freq</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_47_0.png" src="../_images/notebooks_get_started_47_0.png" />
</div>
</div>
<p>As a consequence, the error should be negligible compared to the number of hectares set as input.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Error regarding deforested hectares</span>
<span class="n">future_forest_error</span> <span class="o">=</span> <span class="n">forest_cover</span><span class="p">[</span><span class="s2">&quot;statistics&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">future_forest_hectares</span> <span class="o">=</span> <span class="n">forest_cover</span><span class="p">[</span><span class="s2">&quot;statistics&quot;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
<span class="n">error_perc</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">future_forest_error</span><span class="o">/</span><span class="n">future_forest_hectares</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error (ha): </span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.3f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">future_forest_error</span><span class="p">,</span> <span class="n">error_perc</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Error (ha): 58.10, 0.001%
</pre></div></div>
</div>
<p>We can plot the predicted future forest cover in 2050. The red areas represent the deforestation on the period 2010-2050. The green areas represent the remaining forest in 2050. Most of the remaining forest in 2050 are inside the protected areas or located in remote areas, at high altitudes and far from roads and big cities (for example in the Tsaratanana mountain region and around the Masoala peninsula, north-east Madagascar).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot future forest cover</span>
<span class="n">far</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">forest</span><span class="p">(</span><span class="n">input_forest_raster</span><span class="o">=</span><span class="s2">&quot;output/forest_cover_2050.tif&quot;</span><span class="p">,</span>
                <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/forest_cover_2050.png&quot;</span><span class="p">,</span>
                <span class="n">col</span><span class="o">=</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>  <span class="c1"># rgba color for deforestation</span>
                <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
                <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                <span class="n">zoom</span><span class="o">=</span><span class="p">(</span><span class="mi">340000</span><span class="p">,</span><span class="mi">412000</span><span class="p">,</span><span class="mi">7420000</span><span class="p">,</span><span class="mi">7500000</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_get_started_51_0.png" src="../_images/notebooks_get_started_51_0.png" />
</div>
</div>
</div>
<div class="section" id="Model-validation">
<h2>Model validation<a class="headerlink" href="#Model-validation" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="Deviance-explained">
<h3>Deviance explained<a class="headerlink" href="#Deviance-explained" title="Permalink to this headline">Â¶</a></h3>
<p>We can compute the percentage of deviance explained by the model with or without accounting for spatial autocorrelation. To do so, we need to compute the <a class="reference external" href="http://www.stat.wisc.edu/courses/st849-bates/lectures/GLMDeviance.pdf">deviance of the full (or saturated) and null model</a>. The full model assumes a perfect fit of the data and has a deviance equals to zero. The null model is a simple mean-only model (<span class="math notranslate nohighlight">\(\text{logit}(\theta_i)=\mu\)</span>). The deviance of the null model and of the model
without spatial autocorrelation can be computed using a classical Binomial regression, without hierarchical structure. We will use the <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> Python module to do so.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Additional module</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="c1"># Full model</span>
<span class="n">deviance_full</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># Null model</span>
<span class="n">formula_null</span> <span class="o">=</span> <span class="s2">&quot;I(1-fordefor2010) ~ 1&quot;</span>
<span class="n">Y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">dmatrices</span><span class="p">(</span><span class="n">formula_null</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">NA_action</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;dataframe&quot;</span><span class="p">)</span>
<span class="n">mod_null</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">GLM</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Binomial</span><span class="p">())</span>
<span class="n">fit_null</span> <span class="o">=</span> <span class="n">mod_null</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">deviance_null</span> <span class="o">=</span> <span class="n">fit_null</span><span class="o">.</span><span class="n">deviance</span>
<span class="c1"># Model with no spatial random effects</span>
<span class="n">formula_nsre</span> <span class="o">=</span> <span class="s2">&quot;I(1-fordefor2010) ~ C(sapm) + scale(altitude) +  scale(slope) + </span><span class="se">\</span>
<span class="s2">scale(dist_defor) + np.power(scale(dist_defor),2) + scale(dist_edge) + scale(dist_road) + scale(dist_town)&quot;</span>
<span class="n">Y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">dmatrices</span><span class="p">(</span><span class="n">formula_nsre</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span> <span class="n">NA_action</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;dataframe&quot;</span><span class="p">)</span>
<span class="n">mod_nsre</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">GLM</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">families</span><span class="o">.</span><span class="n">Binomial</span><span class="p">())</span>
<span class="n">fit_nsre</span> <span class="o">=</span> <span class="n">mod_nsre</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">deviance_nsre</span> <span class="o">=</span> <span class="n">fit_nsre</span><span class="o">.</span><span class="n">deviance</span>
<span class="c1"># Model with iCAR process</span>
<span class="n">deviance_icar</span> <span class="o">=</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">Deviance</span>
<span class="c1"># Dataframe</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="s2">&quot;nsre&quot;</span><span class="p">,</span> <span class="s2">&quot;icar&quot;</span><span class="p">,</span> <span class="s2">&quot;full&quot;</span><span class="p">])</span>
<span class="n">dev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">deviance_null</span><span class="p">,</span> <span class="n">deviance_nsre</span><span class="p">,</span> <span class="n">deviance_icar</span><span class="p">,</span> <span class="n">deviance_full</span><span class="p">])</span>
<span class="n">perc</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">dev</span><span class="o">/</span><span class="n">deviance_null</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_items</span><span class="p">([(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">mod</span><span class="p">),</span>
                               <span class="p">(</span><span class="s2">&quot;deviance&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)),</span>
                               <span class="p">(</span><span class="s2">&quot;percentage&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">perc</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  model  deviance  percentage
0  null     27637           0
1  nsre     25537           8
2  icar     19581          29
3  full         0         100
</pre></div></div>
</div>
<p>We see that the model without spatial random effects only explains 8% of the deviance while the model including spatial random effects explains 29% of the deviance. These percentage might appear rather low, but one should remember that we are trying to predict the deforestation at the pixel scale with a precision of 30 meters.</p>
</div>
<div class="section" id="Predictions-vs.Â observations">
<h3>Predictions vs.Â observations<a class="headerlink" href="#Predictions-vs.Â observations" title="Permalink to this headline">Â¶</a></h3>
<p>Another way of assessing model performance is to compute some accuracy indices based on a confusion matrix. We select the following accuracy indices: the Overall Accuracy (OA), the Specificity (Spe), the Sensitivity (Sen), Cohenâs Kappa (K), the True Skill Statistics (TSS) and the Figure Of Merit (FOM). These indices are classical indices used to estimate the accuracy of deforestation models (see for example DezÃ©cache et al.Â 2017, Vieilledent et al.Â 2013 and Pontius et al.Â 2011).</p>
<div class="section" id="Internal-validation">
<h4>Internal validation<a class="headerlink" href="#Internal-validation" title="Permalink to this headline">Â¶</a></h4>
<p>We first compute these indices on the sampling data-set. Here we are interested in seeing if our model is predicting well the location of the deforestation (relative deforestation probability), not the intensity of deforestation (absolute deforestation probability). We then transform the predicted probability of deforestation into binary values using the deforestation probability âobservedâ in the sampling data-set. This last value should be closed to 0.5 as we sampled as many forest and
non-forest pixels, at the exception of the pixels with no-data value for environmental variables. The same proportion of deforested pixels will be applied to the predictions selecting the pixels with the highest predicted deforestation probabilities.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Predictions</span>
<span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;theta_pred&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod_binomial_iCAR</span><span class="o">.</span><span class="n">theta_pred</span>
<span class="c1"># Proportion of deforested pixels</span>
<span class="n">nobs</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;fordefor2010&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>  <span class="c1"># inferior to 20000 as there were NaN</span>
<span class="n">ndefor</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;fordefor2010&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># 0 for deforestation in fordefor2010</span>
<span class="n">proba_defor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ndefor</span><span class="p">)</span><span class="o">/</span><span class="n">nobs</span>  <span class="c1"># not exactly 0.5</span>
<span class="c1"># Probability threshold to transform probability into binary values</span>
<span class="n">proba_thresh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;theta_pred&quot;</span><span class="p">],</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">proba_defor</span><span class="p">))</span>  <span class="c1"># ! must be (1-proba_defor)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;theta_pred&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">proba_thresh</span><span class="p">,</span> <span class="s2">&quot;pred&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># We check that the proportion of deforested pixel is the same for observations/predictions</span>
<span class="n">ndefor_pred</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">proba_defor_pred</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ndefor_pred</span><span class="p">)</span><span class="o">/</span><span class="n">nobs</span>
<span class="n">proba_defor_pred</span> <span class="o">==</span> <span class="n">proba_defor</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>We use function <code class="docutils literal notranslate"><span class="pre">accuracy_indices()</span></code> from the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> package to compute the accuracy indices.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Accuracy indices</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">obs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;fordefor2010&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">internal_validation</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">accuracy_indices</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">obs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">internal_validation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;K&#39;: 0.58, &#39;OA&#39;: 0.79, &#39;Spe&#39;: 0.79, &#39;Sen&#39;: 0.79, &#39;FOM&#39;: 0.65, &#39;TSS&#39;: 0.58}
</pre></div></div>
</div>
<p>The accuracy indices show that the model has good predictive abilities. Their value is relatively high (close to 1). Once we know the number of pixels to be deforested, the model correctly identifies the pixels that should be deforested first.</p>
</div>
<div class="section" id="External-validation">
<h4>External validation<a class="headerlink" href="#External-validation" title="Permalink to this headline">Â¶</a></h4>
<p>We can also compute these indices using independant observations. To do so, we will compare the predicted deforestation on the period 2010-2014 with the true observed deforestation on the same period. The forest cover for the year 2014 for Madagascar can be downloaded from the BioSceneMada website.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Download forest cover for 2014</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;wget -P data http://bioscenemada.cirad.fr/FileTransfer/for2014.tif&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>We compute the observed forest-cover change between 2010 and 2014 using <code class="docutils literal notranslate"><span class="pre">gdal_calc.py</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Forest-cover change between 2010 and 2014</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;gdal_translate -a_nodata 99 -co &#39;COMPRESS=LZW&#39; -co &#39;PREDICTOR=2&#39; </span><span class="se">\</span>
<span class="s2">                          data/fordefor2010.tif output/fordefor2010_.tif&quot;</span><span class="p">)</span> <span class="c1"># Set nodata different from 255</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;gdal_translate -a_nodata 99 -co &#39;COMPRESS=LZW&#39; -co &#39;PREDICTOR=2&#39; </span><span class="se">\</span>
<span class="s2">                          data/for2014.tif output/for2014_.tif&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;gdal_calc.py --overwrite -A output/fordefor2010_.tif -B output/for2014_.tif </span><span class="se">\</span>
<span class="s2">                --outfile=output/fcc_2010_2014_obs.tif --type=Byte </span><span class="se">\</span>
<span class="s2">                --calc=&#39;255-254*(A==1)*(B==1)-255*(A==1)*(B==255)&#39; --co &#39;COMPRESS=LZW&#39; --co &#39;PREDICTOR=2&#39; </span><span class="se">\</span>
<span class="s2">                --NoDataValue=255&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>We then need to compute the number of hectares that have been deforested between 2010 and 2014. We use <code class="docutils literal notranslate"><span class="pre">gdalinfo</span></code> to do so.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[81]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Compute deforestation between 2010 and 2014</span>
<span class="n">out_2010</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;gdalinfo -stats -hist -noct -norat -nomd data/for2014.tif&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">out_2014</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;gdalinfo -stats -hist -noct -norat -nomd data/fordefor2010.tif&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c1">#print(out_2010)</span>
<span class="c1">#print(out_2014)</span>
<span class="n">d0014</span> <span class="o">=</span> <span class="p">(</span><span class="mi">103445946</span><span class="o">-</span><span class="mi">98994821</span><span class="p">)</span><span class="o">*</span><span class="mi">30</span><span class="o">*</span><span class="mi">30</span><span class="o">/</span><span class="mi">10000</span> <span class="c1"># deforestation in ha</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d0014</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
400601
</pre></div></div>
</div>
<p>400601 hectares have been deforested between 2010 and 2014.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Predicting forest cover in 2014</span>
<span class="n">fcc_2010_2014_prd</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">deforest</span><span class="p">(</span><span class="n">input_raster</span><span class="o">=</span><span class="s2">&quot;output/pred_binomial_iCAR.tif&quot;</span><span class="p">,</span>
                                 <span class="n">hectares</span><span class="o">=</span><span class="n">d0014</span><span class="p">,</span>
                                 <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;output/fcc_2010_2014_pred.tif&quot;</span><span class="p">,</span>
                                 <span class="n">blk_rows</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Divide region in 398 blocks
Compute the total number of forest pixels
100%
Compute the histogram of values
100%
Identify threshold
Minimize error on deforested hectares
Create a raster file on disk for forest cover
Write raster of forest cover
100%
Compute statistics
Build overview
Make figure
</pre></div></div>
</div>
<p>Finally, we compute the accuracy indices comparing the predicted and observed forest-cover change map between 2010 and 2014 using function <code class="docutils literal notranslate"><span class="pre">validation()</span></code> from the <code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> package.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[86]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Computing accuracy indices</span>
<span class="n">external_validation</span> <span class="o">=</span> <span class="n">far</span><span class="o">.</span><span class="n">validation</span><span class="p">(</span><span class="n">pred</span><span class="o">=</span><span class="s2">&quot;output/fcc_2010_2014_pred.tif&quot;</span><span class="p">,</span>
                                     <span class="n">obs</span><span class="o">=</span><span class="s2">&quot;output/fcc_2010_2014_obs.tif&quot;</span><span class="p">,</span>
                                     <span class="n">blk_rows</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Divide region in 398 blocks
Compute the confusion matrix
100%
             obs0       obs1
pred0  94581745.0  3971324.0
pred1   3984113.0   466892.0
Compute accuracy indices
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[87]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">external_validation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;K&#39;: 0.06, &#39;OA&#39;: 0.92, &#39;Spe&#39;: 0.96, &#39;Sen&#39;: 0.11, &#39;FOM&#39;: 0.06, &#39;TSS&#39;: 0.06}
</pre></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this headline">Â¶</a></h2>
<p><strong>DezÃ©cache, C.; Salles, J.-M.; Vieilledent, G. &amp; HÃ©rault, B.</strong> 2017. Moving forward socio-economically focused models of deforestation. <em>Global Change Biology</em>. in press. doi: <a class="reference external" href="http://doi.org/10.1111/gcb.13611">10.1111/gcb.13611</a></p>
<p><strong>Hansen, M. C.; Potapov, P. V.; Moore, R.; Hancher, M.; Turubanova, S. A.; Tyukavina, A.; Thau, D.; Stehman, S. V.; Goetz, S. J.; Loveland, T. R.; Kommareddy, A.; Egorov, A.; Chini, L.; Justice, C. O. &amp; Townshend, J. R. G.</strong> 2013. High-Resolution Global Maps of 21st-Century Forest Cover Change. <em>Science</em>. 342:850-853. doi: <a class="reference external" href="http://doi.org/10.1126/science.1244693">10.1126/science.1244693</a></p>
<p><strong>Harper, G. J.; Steininger, M. K.; Tucker, C. J.; Juhn, D. &amp; Hawkins, F.</strong> 2007. Fifty years of deforestation and forest fragmentation in Madagascar. <em>Environmental Conservation</em>. 34:325-333. doi: <a class="reference external" href="http://doi.org/10.1017/S0376892907004262">10.1017/S0376892907004262</a></p>
<p><strong>Pontius R. G. Jr., J. &amp; Millones, M.</strong> 2011. Death to Kappa: birth of quantity disagreement and allocation disagreement for accuracy assessment. <em>International Journal of Remote Sensing</em>. 32:4407-4429. doi: <a class="reference external" href="http://doi.org/10.1080/01431161.2011.552923">10.1080/01431161.2011.552923</a></p>
<p><strong>Vieilledent, G.; Merow, C.; GuÃ©lat, J.; Latimer, A. M.; KÃ©ry, M.; Gelfand, A. E.; Wilson, A. M.; Mortier, F. &amp; Silander Jr., J. A.</strong> 2014. hSDM CRAN release v1.4 for hierarchical Bayesian species distribution models. <em>Zenodo</em>. doi: <a class="reference external" href="http://doi.org/10.5281/zenodo.48470">10.5281/zenodo.48470</a></p>
<p><strong>Vieilledent, G.; Grinand, C. &amp; Vaudry, R.</strong> 2013. Forecasting deforestation and carbon emissions in tropical developing countries facing demographic expansion: a case study in Madagascar. <em>Ecology and Evolution</em>. 3:1702-1716. doi: <a class="reference external" href="http://doi.org/10.1002/ece3.550">10.1002/ece3.550</a></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo-far.svg" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">Modelling and forecasting deforestation in the tropics</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=ghislainv&repo=forestatrisk&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Get started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Downloading-and-preparing-the-data">Downloading and preparing the data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Sampling-the-observations">Sampling the observations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Descriptive-statistics">Descriptive statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Spatial-deforestation-model">Spatial deforestation model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Results-of-the-model">Results of the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Predicting-the-spatial-probability-of-deforestation">Predicting the spatial probability of deforestation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Predicting-the-future-forest-cover">Predicting the future forest cover</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Model-validation">Model validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#References">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../index.html" title="previous chapter"><code class="docutils literal notranslate"><span class="pre">forestatrisk</span></code> Python package</a></li>
      <li>Next: <a href="../reference.html" title="next chapter">Reference</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Ghislain Vieilledent.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/notebooks/get_started.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>